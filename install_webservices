#!/bin/bash

clear
cat <<'EOF'
Hej och v√§lkommen till LAMP-INSTALLERAREN! üöÄ

Detta skript hj√§lper dig att installera olika delar av en LAMP-stack p√• Ubuntu/Debian:

1Ô∏è‚É£ PHP + Apache
2Ô∏è‚É£ MariaDB + Apache + PHP + phpMyAdmin
3Ô∏è‚É£ Komplett LAMP-stack (Apache + MariaDB + PHP + phpMyAdmin + s√§kerhet)
4Ô∏è‚É£ Avbryt

Skriptet kommer uppdatera paketlistan och starta relevanta tj√§nster automatiskt.
EOF

echo ""
read -p "Ange ditt val (1/2/3/4): " choice

if [[ "$choice" == "4" ]]; then
    echo "‚ùå Avbryter installationen."
    exit 0
fi

read -p "Vill du forts√§tta installationen? (ja/nej): " confirm
if [[ "$confirm" != "ja" && "$confirm" != "Ja" ]]; then
    echo "‚ùå Installation avbruten."
    exit 0
fi

echo ""
echo "‚öôÔ∏è  Uppdaterar paketlistan..."
sudo apt update

install_php_apache() {
    echo ""
    echo "üíª Installerar PHP och Apache..."
    sudo apt install -y apache2 php libapache2-mod-php

    read -p "Vill du skapa en index.php-fil i /var/www/html/? (ja/nej): " createfile
    if [[ "$createfile" == "ja" || "$createfile" == "Ja" ]]; then
        sudo mkdir -p /var/www/html
        echo "<?php phpinfo(); ?>" | sudo tee /var/www/html/index.php > /dev/null
        echo "‚úÖ index.php skapad i /var/www/html/"
    fi

    sudo systemctl enable apache2
    sudo systemctl start apache2
    echo "‚úÖ PHP + Apache installation klar!"
}

install_mariadb_phpmyadmin() {
    echo ""
    echo "üíæ Installerar MariaDB, Apache, PHP och phpMyAdmin..."
    export DEBIAN_FRONTEND=noninteractive
    sudo apt install -y apache2 php libapache2-mod-php php-mysql mariadb-server mariadb-client phpmyadmin

    sudo systemctl enable apache2
    sudo systemctl start apache2
    sudo systemctl enable mariadb
    sudo systemctl start mariadb

    echo "‚úÖ MariaDB + Apache + PHP + phpMyAdmin installation klar!"
}

install_complete_lamp() {
    echo ""
    echo "üõ†Ô∏è Installerar komplett LAMP-stack..."
    export DEBIAN_FRONTEND=noninteractive
    sudo apt install -y apache2 mariadb-server mariadb-client php libapache2-mod-php php-mysql phpmyadmin ufw

    sudo systemctl enable apache2
    sudo systemctl start apache2
    sudo systemctl enable mariadb
    sudo systemctl start mariadb

    # Aktivera Apache mod_rewrite
    sudo a2enmod rewrite
    sudo systemctl restart apache2

    # Brandv√§gg
    sudo ufw allow OpenSSH
    sudo ufw allow in "Apache Full"
    sudo ufw status | grep -q "inactive" && sudo ufw --force enable

    echo ""
    echo "üîí S√§kerst√§ll MariaDB-installationen med mysql_secure_installation:"
    sudo mysql_secure_installation

    # Skapa testfil
    sudo mkdir -p /var/www/html
    echo "<?php phpinfo(); ?>" | sudo tee /var/www/html/index.php > /dev/null

    echo "‚úÖ Komplett LAMP-stack installerad och konfigurerad!"
}

echo ""
echo "----------------------------------------"
case "$choice" in
    1)
        echo "Du har valt: PHP + Apache"
        install_php_apache
        ;;
    2)
        echo "Du har valt: MariaDB + Apache + PHP + phpMyAdmin"
        install_mariadb_phpmyadmin
        ;;
    3)
        echo "Du har valt: Komplett LAMP-stack"
        install_complete_lamp
        ;;
    *)
        echo "‚ùå Ogiltigt val, avbryter."
        exit 1
        ;;
esac

echo ""
echo "üéâ Alla valda installationer √§r klara!"
